---
import { Icon } from 'astro-icon/components'
import { SITE } from 'astrowind:config'
import { trimSlash } from '~/utils/permalinks'

const base = SITE.base
const makeHref = (p) => `${base}${trimSlash(p)}`.replace(/\/+$/, '/')
const currentUrl = new URL(Astro.url).pathname

const nav = [
  { text: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', path: '' },
  { text: 'Ø§Ù„Ø£ÙˆØ§Ù…Ø±', path: 'commands' },
  { text: 'Ø§Ù„ØªØ±ØªÙŠØ¨', path: 'leaderboards' },
  { text: 'Ø§Ù„Ø¨Ø¯Ø¬Ø§Øª', path: 'badges' },
  { text: 'Ø§Ù„Ø£ØºØ±Ø§Ø¶', path: 'items' },
  { text: 'Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª', path: 'challenges' },
  { text: 'Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†', path: 'winners' },
]
---

<style>
  /* ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
  @keyframes dropdownSlide {
    0% {
      opacity: 0;
      transform: translateY(-12px);
      filter: blur(4px);
    }
    60% {
      opacity: 1;
      transform: translateY(4px);
      filter: blur(0px);
    }
    100% {
      transform: translateY(0);
    }
  }
  .dropdown-animate {
    animation: dropdownSlide 0.35s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
  }

  /* Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
  @keyframes dropdownClose {
    0% {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0px);
    }
    100% {
      opacity: 0;
      transform: translateY(-12px);
      filter: blur(4px);
    }
  }
  .dropdown-close {
    animation: dropdownClose 0.28s ease-out forwards;
  }

  /* Glow Ø¨Ø³ÙŠØ· Ù„Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙ‚Ø· */
  @keyframes pulseGlow {
    0% {
      box-shadow: 0 0 6px rgba(198,164,79,0.25);
    }
    50% {
      box-shadow: 0 0 14px rgba(198,164,79,0.55);
    }
    100% {
      box-shadow: 0 0 6px rgba(198,164,79,0.25);
    }
  }

  .menu-link {
    transition:
      box-shadow 0.25s ease,
      border-color 0.25s ease,
      background-color 0.25s ease,
      transform 0.25s ease;
  }

  .menu-link:hover {
    animation: pulseGlow 1.2s ease-in-out infinite;
    border-color: #c6a44f !important;
  }

  /* ğŸ”¥ Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù†ÙØ³Ù‡ */
  .menu-button {
    transition:
      transform 0.14s ease,
      box-shadow 0.14s ease,
      border-color 0.14s ease,
      background-color 0.14s ease;
    transform-origin: center;
  }

  /* ÙŠØµØºØ± Ù„Ø­Ø¸Ø© Ø§Ù„Ø¶ØºØ· ÙˆÙŠØ±Ø¬Ø¹ */
  .menu-button:active {
    transform: scale(0.92);
    box-shadow: 0 0 12px rgba(198,164,79,0.6);
  }

  /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®Ø·ÙˆØ· */
  .menu-icon {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 18px;
    height: 14px;
  }

  .menu-line {
    display: block;
    width: 100%;
    height: 2px;
    border-radius: 9999px;
    background-color: #ffda6a;
    transition: transform 0.22s ease, opacity 0.22s ease;
  }

  .menu-line.middle {
    margin: 3px 0;
  }

  /* Ù„Ù…Ø§ ØªÙƒÙˆÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØªÙˆØ­Ø© ØªØªØ­ÙˆÙ„ Ø§Ù„Ø®Ø·ÙˆØ· Ø¥Ù„Ù‰ X */
  .menu-button.menu-open .menu-line.top {
    transform: translateY(5px) rotate(45deg);
  }

  .menu-button.menu-open .menu-line.middle {
    opacity: 0;
  }

  .menu-button.menu-open .menu-line.bottom {
    transform: translateY(-5px) rotate(-45deg);
  }
</style>

<header class="top-0 z-40 relative w-full bg-[#0a0a0c]/95 border-b border-[#c6a44f]/30 shadow-[0_0_15px_rgba(198,164,79,0.3)] backdrop-blur-md">
  <div class="max-w-7xl mx-auto px-6 flex items-center justify-between py-4">

    <!-- Logo -->
    <a
      href={makeHref('')}
      class="flex items-center space-x-3 text-[#d5b76c] font-extrabold text-2xl tracking-wide drop-shadow-[0_0_10px_rgba(198,164,79,0.6)]"
    >
      <Icon name="tabler:brand-twitch" class="w-7 h-7 text-[#c6a44f]" />
      <span>TNX</span>
    </a>

    <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
    <button
      id="tnx-menu-btn"
      type="button"
      class="menu-button flex items-center gap-2 px-4 py-2 rounded-md border border-[#c6a44f]/40 text-[#ffda6a] bg-black/40 hover:bg-[#c6a44f]/10"
      onclick="
        const menu = document.getElementById('dropdownMenu');
        const isHidden = menu.classList.contains('hidden');
        const btn = this;

        if (isHidden) {
          // ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          btn.classList.add('menu-open');

          menu.classList.remove('dropdown-close');
          menu.classList.remove('hidden');
          menu.classList.add('dropdown-animate');
          setTimeout(() => menu.classList.remove('dropdown-animate'), 400);
        } else {
          // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          btn.classList.remove('menu-open');

          menu.classList.remove('dropdown-animate');
          menu.classList.add('dropdown-close');
          setTimeout(() => {
            menu.classList.add('hidden');
            menu.classList.remove('dropdown-close');
          }, 280);
        }
      "
    >
      <div class="menu-icon">
        <span class="menu-line top"></span>
        <span class="menu-line middle"></span>
        <span class="menu-line bottom"></span>
      </div>
      <span>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
    </button>
  </div>

  <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© -->
  <div id="dropdownMenu" class="hidden px-6 pb-4 space-y-3">
    {nav.map(({ text, path }) => {
      const href = makeHref(path)
      const isActive = currentUrl === href
      return (
        <a
          href={href}
          class:list={[
            'menu-link block w-full text-center px-4 py-3 rounded-lg bg-black/40 border border-[#c6a44f]/30 text-[#ffda6a] hover:bg-[#c6a44f]/10 transition',
            { 'bg-[#c6a44f]/20': isActive },
          ]}
        >
          {text}
        </a>
      )
    })}
  </div>
</header>
