---
import { Icon } from 'astro-icon/components'
import { SITE } from 'astrowind:config'
import { trimSlash } from '~/utils/permalinks'

const base = SITE.base
const makeHref = (p) => `${base}${trimSlash(p)}`.replace(/\/+$/, '/')
const currentUrl = new URL(Astro.url).pathname

const nav = [
  { text: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', path: '' },
  { text: 'Ø§Ù„Ø£ÙˆØ§Ù…Ø±', path: 'commands' },
  { text: 'Ø§Ù„ØªØ±ØªÙŠØ¨', path: 'leaderboards' },
  { text: 'Ø§Ù„Ø¨Ø¯Ø¬Ø§Øª', path: 'badges' },
  { text: 'Ø§Ù„Ø£ØºØ±Ø§Ø¶', path: 'items' },
  { text: 'Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª', path: 'challenges' },
  { text: 'Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†', path: 'winners' },
]
---

<style>
  /* ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
  @keyframes dropdownSlide {
    0% {
      opacity: 0;
      transform: translateY(-12px);
      filter: blur(4px);
    }
    60% {
      opacity: 1;
      transform: translateY(4px);
      filter: blur(0px);
    }
    100% {
      transform: translateY(0);
    }
  }
  .dropdown-animate {
    animation: dropdownSlide 0.35s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
  }

  /* Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
  @keyframes dropdownClose {
    0% {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0px);
    }
    100% {
      opacity: 0;
      transform: translateY(-12px);
      filter: blur(4px);
    }
  }
  .dropdown-close {
    animation: dropdownClose 0.28s ease-out forwards;
  }

  /* Glow */
  @keyframes pulseGlow {
    0% {
      box-shadow: 0 0 6px rgba(198,164,79,0.25);
    }
    50% {
      box-shadow: 0 0 14px rgba(198,164,79,0.55);
    }
    100% {
      box-shadow: 0 0 6px rgba(198,164,79,0.25);
    }
  }

  .menu-glow {
    transition: all 0.25s ease;
  }

  /* âœ… Ù‡ÙˆÙØ± Ø¨Ø¯ÙˆÙ† ØªØµØºÙŠØ±/ØªÙƒØ¨ÙŠØ± ÙˆÙ„Ø§ Ø£Ù†Ù…ÙŠØ´Ù† Ù…Ø³ØªÙ…Ø± */
  .menu-pulse:hover {
    animation: none; /* Ù†ÙˆÙ‚Ù Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù† */
    transform: none; /* Ù†ØªØ£ÙƒØ¯ Ù…Ø§ ÙÙŠ scale */
    border-color: #c6a44f !important;
    box-shadow: 0 0 10px rgba(198,164,79,0.5);
  }

  /* ğŸ”¥ Ø£Ù†Ù…ÙŠØ´Ù† ÙƒØ¨Ø³ Ø§Ù„Ø²Ø± (ÙŠØµØºØ± Ø«Ù… ÙŠÙƒØ¨Ø±) */
  @keyframes menuClickPop {
    0%   { transform: scale(1); }
    50%  { transform: scale(0.9); }
    100% { transform: scale(1); }
  }

  .menu-toggle {
    transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
    transform-origin: center;
  }

  .menu-click {
    animation: menuClickPop 0.18s ease-out;
  }

  /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø«Ù„Ø§Ø«Ø© */
  .menu-icon {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 18px;
    height: 14px;
  }

  .menu-line {
    display: block;
    width: 100%;
    height: 2px;
    border-radius: 9999px;
    background-color: #ffda6a;
    transition: transform 0.22s ease, opacity 0.22s ease;
  }

  .menu-line.middle {
    margin: 3px 0;
  }

  /* Ù„Ù…Ø§ ØªÙƒÙˆÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØªÙˆØ­Ø© ØªØªØ­ÙˆÙ„ Ø§Ù„Ø®Ø·ÙˆØ· Ø¥Ù„Ù‰ X */
  .menu-toggle.menu-open .menu-line.top {
    transform: translateY(5px) rotate(45deg);
  }

  .menu-toggle.menu-open .menu-line.middle {
    opacity: 0;
  }

  .menu-toggle.menu-open .menu-line.bottom {
    transform: translateY(-5px) rotate(-45deg);
  }
</style>

<header class="top-0 z-40 relative w-full bg-[#0a0a0c]/95 border-b border-[#c6a44f]/30 shadow-[0_0_15px_rgba(198,164,79,0.3)] backdrop-blur-md">
  <div class="max-w-7xl mx-auto px-6 flex items-center justify-between py-4">

    <!-- Logo -->
    <a href={makeHref('')} class="flex items-center space-x-3 text-[#d5b76c] font-extrabold text-2xl tracking-wide drop-shadow-[0_0_10px_rgba(198,164,79,0.6)]">
      <Icon name="tabler:brand-twitch" class="w-7 h-7 text-[#c6a44f]" />
      <span>TNX</span>
    </a>

    <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
    <button
      id="tnx-menu-btn"
      type="button"
      class="menu-toggle menu-glow menu-pulse flex items-center gap-2 px-4 py-2 rounded-md border border-[#c6a44f]/40 text-[#ffda6a] hover:bg-[#c6a44f]/10 transition"
      onclick="
        const menu = document.getElementById('dropdownMenu');
        const isHidden = menu.classList.contains('hidden');
        const btn = this;

        // Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„ØªØµØºÙŠØ± Ø«Ù… Ø§Ù„ØªÙƒØ¨ÙŠØ± (Ø¹Ù„Ù‰ Ø§Ù„Ø¶ØºØ· ÙÙ‚Ø·)
        btn.classList.remove('menu-click');
        void btn.offsetWidth; // Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù†
        btn.classList.add('menu-click');

        if (isHidden) {
          // ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          btn.classList.add('menu-open');

          menu.classList.remove('dropdown-close');
          menu.classList.remove('hidden');
          menu.classList.add('dropdown-animate');
          setTimeout(() => menu.classList.remove('dropdown-animate'), 400);
        } else {
          // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          btn.classList.remove('menu-open');

          menu.classList.remove('dropdown-animate');
          menu.classList.add('dropdown-close');
          setTimeout(() => {
            menu.classList.add('hidden');
            menu.classList.remove('dropdown-close');
          }, 280);
        }
      "
    >
      <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
      <div class="menu-icon">
        <span class="menu-line top"></span>
        <span class="menu-line middle"></span>
        <span class="menu-line bottom"></span>
      </div>
      <span>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
    </button>
  </div>

  <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© -->
  <div id="dropdownMenu" class="hidden px-6 pb-4 space-y-3">
    {nav.map(({ text, path }) => {
      const href = makeHref(path)
      const isActive = currentUrl === href
      return (
        <a
          href={href}
          class:list={[
            'menu-glow menu-pulse block w-full text-center px-4 py-3 rounded-lg bg-black/40 border border-[#c6a44f]/30 text-[#ffda6a] hover:bg-[#c6a44f]/10 transition',
            { 'bg-[#c6a44f]/20': isActive },
          ]}
        >
          {text}
        </a>
      )
    })}
  </div>
</header>
